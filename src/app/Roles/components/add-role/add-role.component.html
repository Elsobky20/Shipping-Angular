<div class="row">
  <div class="content-wrapper container-fluid p-0">
    <div class="col-12 grid-margin stretch-card">
      <div class="card" style="max-height: 100vh !important">
        <div class="card-body p-5 py-3" style="height: 80vh !important; max-height: 100vh !important">
          <div class="row mt-2 d-flex justify-content-between mb-2">
            <h4 class="card-title fs-3 col-sm-8" style="color: #9c57ff; font-weight: bold; letter-spacing: 1px">
              {{ isEditMode ? 'Edit Role' : 'Add New Role' }}
            </h4>
            <a
              class="btn btn-light col-sm-1 px-0 d-flex align-items-center justify-content-center ms-auto me-2"
              style="color: #9c57ff; letter-spacing: 0.8px; height: 42px; width: 42px; border-radius: 50%"
              title="Back to roles"
              href="/roles"
            >
              <i class="bi bi-skip-backward-circle fs-2"></i>
            </a>
          </div>

          <form (ngSubmit)="saveRole()" class="row col-sm-12 table-responsive table-bordered rounded mx-auto" style="max-height: 85%">
            <div class="row">

              <!-- Role Name -->
              <div class="col-md-6">
                <div class="form-group my-3">
                  <label for="name">Role Name</label>
                  <input
                    type="text"
                    id="name"
                    class="form-control"
                    [(ngModel)]="roleNameProxy"
                    name="name"
                    required
                    placeholder="Enter role name"
                  />
                </div>
              </div>

              <!-- IsDeleted (create only) -->
              <div class="col-md-6" *ngIf="!isEditMode">
                <div class="form-group my-3 d-flex align-items-center">
                  <input
                    type="checkbox"
                    [(ngModel)]="createRole.isDeleted"
                    name="isDeleted"
                    class="form-check-input me-2"
                    id="isDeleted"
                  />
                  <label for="isDeleted" class="mb-0">Is Deleted</label>
                </div>
              </div>

              <!-- Normalized Name (create only) -->
              <div class="col-md-6" *ngIf="!isEditMode">
                <div class="form-group my-3">
                  <label for="normalizedName">Normalized Name</label>
                  <input
                    type="text"
                    id="normalizedName"
                    class="form-control bg-light text-muted"
                    [value]="createRole.name.toUpperCase()"
                    readonly
                  />
                </div>
              </div>

              <!-- Permissions Section -->
              <div class="col-12 mt-4">
                <h5 class="text-lg fw-semibold text-dark mb-3">Permissions</h5>

                <div *ngIf="permissions.length === 0" class="text-danger mb-3">
                  <p>No permissions available. Please add permissions to the system first.</p>
                </div>

                <div *ngFor="let permission of permissions; let i = index"
                class="border rounded p-3 mb-3 shadow-sm overflow-hidden">
             <h6 class="fw-bold mb-3">Permission {{ permission.name || permission.id }}</h6>
           
             <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
               <div class="col" *ngFor="let perm of permissionKeys">
                 <div class="form-check">
                   <input
                     type="checkbox"
                     class="form-check-input"
                     [(ngModel)]="rolePermissions[i][perm]"
                     [name]="perm + '-' + i"
                     [id]="perm + '-' + i"
                   />
                   <label class="form-check-label" [for]="perm + '-' + i">{{ perm | titlecase }}</label>
                 </div>
               </div>
             </div>
           </div>
           
                </div>

              <!-- Error Message -->
              <div *ngIf="errorMessage" class="col-12 bg-danger bg-opacity-10 text-danger p-3 rounded border border-danger">
                {{ errorMessage }}
              </div>

              <!-- Buttons -->
              <div class="row mt-4 px-3">
                <button
                  type="submit"
                  class="btn btn-gradient-primary me-2 col-sm-3 px-0"
                  style="letter-spacing: 0.8px"
                >
                  {{ isEditMode ? 'Update' : 'Add' }}
                </button>

                <a
                  class="btn btn-light col-sm-3 px-0 d-flex align-items-center justify-content-center"
                  style="color: rgb(95, 95, 95); letter-spacing: 0.8px"
                  href="/roles"
                >
                  Cancel
                </a>
              </div>

            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
